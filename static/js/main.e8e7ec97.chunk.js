(this["webpackJsonparound-react"]=this["webpackJsonparound-react"]||[]).push([[0],{19:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),c=n(20),i=n.n(c),r=n(8),s=(n(19),n(18)),l=n(10),u=n(2),d=n(3),p=n(14),j=n(0),b=["text","link"];var m=function(e){var t=e.text,n=e.link,a=Object(p.a)(e,b);return Object(j.jsxs)("header",{className:"header",children:[Object(j.jsx)("div",{className:"header__logo"}),a.isLoggedIn?Object(j.jsxs)("div",{className:"header__status",children:[Object(j.jsx)("div",{className:"header__email",children:a.email}),Object(j.jsx)(r.b,{to:n,className:"header__link header__link-logout",onClick:a.onSignOut,children:t})]}):Object(j.jsx)(r.b,{to:n,className:"header__link",children:t})]})};var h=Object(d.h)((function(e){var t=e.onLogin,n=Object(a.useState)(""),c=Object(u.a)(n,2),i=c[0],s=c[1],l=Object(a.useState)(""),d=Object(u.a)(l,2),p=d[0],b=d[1];return o.a.useEffect((function(){s(""),b("")}),[]),Object(j.jsxs)("div",{className:"auth",children:[Object(j.jsx)("h2",{className:"auth__title",children:"Log in"}),Object(j.jsxs)("form",{className:"form auth__form",onSubmit:function(e){e.preventDefault(),t({email:i,password:p})},children:[Object(j.jsx)("input",{className:"form__input auth__input",name:"email",value:i||"",type:"email",onChange:function(e){return s(e.target.value)},placeholder:"Email",required:!0}),Object(j.jsx)("input",{className:"form__input auth__input",name:"password",value:p||"",type:"password",onChange:function(e){return b(e.target.value)},placeholder:"Password",required:!0}),Object(j.jsx)("button",{className:"form__button auth__button",children:"Log in"})]}),Object(j.jsxs)("div",{className:"auth__text",children:["Not a member yet? ",Object(j.jsx)(r.b,{to:"/signup",className:"auth__link",children:"Sign up here!"})]})]})}));var f=Object(d.h)((function(e){var t=e.onSignUp,n=Object(a.useState)(""),c=Object(u.a)(n,2),i=c[0],s=c[1],l=Object(a.useState)(""),d=Object(u.a)(l,2),p=d[0],b=d[1];return o.a.useEffect((function(){s(""),b("")}),[]),Object(j.jsxs)("div",{className:"auth",children:[Object(j.jsx)("h2",{className:"auth__title",children:"Sign up"}),Object(j.jsxs)("form",{className:"form auth__form",onSubmit:function(e){e.preventDefault(),t({email:i,password:p})},children:[Object(j.jsx)("input",{className:"form__input auth__input ",name:"email",value:i||"",type:"email",onChange:function(e){return s(e.target.value)},placeholder:"Email",required:!0}),Object(j.jsx)("input",{className:"form__input auth__input",name:"password",value:p||"",type:"password",onChange:function(e){return b(e.target.value)},placeholder:"Password",required:!0}),Object(j.jsx)("button",{className:"form__button auth__button",children:"Sign up"})]}),Object(j.jsxs)("div",{className:"register__signin",children:["Already a member?  ",Object(j.jsx)(r.b,{to:"/signin",className:"auth__link",children:"Log in here"})]})]})})),_=n.p+"static/media/error.df8eddf6.svg",O=n.p+"static/media/ok.1b6082f8.svg";var g=function(e){var t=e.isOpen,n=e.onClose,a=e.isSuccessful,o=e.message,c=(e.children,"popup info-tooltip ".concat(t?"popup_open":"")),i=a?O:_;return Object(j.jsx)("div",{className:c,children:Object(j.jsxs)("div",{className:"popup__container info-tooltip__container",children:[Object(j.jsx)("button",{type:"button","aria-label":"Close",className:"popup__close-button",onClick:n}),Object(j.jsx)("img",{src:i,className:"info-tooltip__image",alt:"Status Failure or Successful"}),Object(j.jsx)("h3",{className:"popup__title info-tooltip__text",children:o})]})})},x=["isLoggedIn"];var v=function(e){var t=e.isLoggedIn,n=Object(p.a)(e,x);return Object(j.jsx)(d.b,{children:function(){return t?Object(j.jsx)(d.b,Object(l.a)({},n)):Object(j.jsx)(d.a,{to:"/signin"})}})},C=o.a.createContext();var N=function(e){var t=e.card,n=e.onCardClick,a=e.onCardLike,c=e.onCardDelete,i=o.a.useContext(C),r=t.owner._id===i._id,s="card__delete ".concat(r?"card__delete_visible":"card__delete_hidden"),l=t.likes.some((function(e){return e._id===i._id})),u="card__like ".concat(l?"card__like_active":"");return Object(j.jsxs)("li",{className:"card",children:[Object(j.jsx)("img",{src:t.link,alt:t.name,className:"card__image",onClick:function(){return n(t)}}),Object(j.jsx)("button",{type:"button","aria-label":"Delete",className:s,onClick:function(){return c(t)}}),Object(j.jsxs)("div",{className:"card__row",children:[Object(j.jsx)("h2",{className:"card__title",children:t.name}),Object(j.jsxs)("div",{className:"card__like-container",children:[Object(j.jsx)("button",{type:"button","aria-label":"Like",className:u,onClick:function(){return a(t)}}),Object(j.jsx)("span",{className:"card__likes-count",children:t.likes.length})]})]})]})};var k=function(e){var t=e.cards,n=e.onEditAvatarClick,a=e.onEditProfileClick,c=e.onAddPlaceClick,i=e.onCardClick,r=e.onCardLike,s=e.onCardDelete,l=o.a.useContext(C);return Object(j.jsxs)("main",{className:"content",children:[Object(j.jsxs)("section",{className:"profile",children:[Object(j.jsxs)("div",{className:"profile__image-container",children:[Object(j.jsx)("img",{src:l.avatar,alt:l.name,className:"profile__image"}),Object(j.jsx)("button",{className:"profile__update-image",onClick:n})]}),Object(j.jsxs)("div",{className:"profile__section-information",children:[Object(j.jsxs)("div",{className:"profile__row-information",children:[Object(j.jsx)("h1",{className:"profile__name",children:l.name}),Object(j.jsx)("button",{type:"button","aria-label":"Edit",className:"profile__edit-button",onClick:a})]}),Object(j.jsxs)("p",{className:"profile__job",children:[" ",l.about]})]}),Object(j.jsx)("button",{type:"button","aria-label":"Add",className:"profile__add-button",onClick:c})]}),Object(j.jsx)("section",{className:"cards",children:Object(j.jsx)("ul",{className:"cards__list",children:t.map((function(e){return Object(j.jsx)(N,{card:e,onCardClick:i,onCardLike:r,onCardDelete:s},e._id)}))})})]})};var S=function(e){var t=e.name,n=e.title,a=e.formName,o=e.buttonSubmitTitle,c=e.isOpen,i=e.onClose,r=e.onSubmit,s=e.children,l="popup popup_type_".concat(t," ").concat(c?"popup_open":"");return Object(j.jsx)("div",{className:l,children:Object(j.jsxs)("div",{className:"popup__container",children:[Object(j.jsx)("button",{type:"button","aria-label":"Close",className:"popup__close-button",onClick:i}),Object(j.jsx)("h3",{className:"popup__title",children:n}),Object(j.jsxs)("form",{name:a,action:"#",className:"form",onSubmit:r,children:[s,Object(j.jsx)("button",{type:"submit","aria-label":"Submit",className:"form__button",children:o})]})]})})};var y=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateUser,c=o.a.useContext(C),i=o.a.useState(""),r=Object(u.a)(i,2),s=r[0],l=r[1],d=o.a.useState(""),p=Object(u.a)(d,2),b=p[0],m=p[1];return o.a.useEffect((function(){l(c.name),m(c.about)}),[c,t]),Object(j.jsxs)(S,{name:"edit-profile",title:"Edit Profile",formName:"profile",buttonSubmitTitle:"Save",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:s,about:b})},children:[Object(j.jsx)("input",{type:"text",name:"name",id:"name-input",className:"form__input form__input_type_name",placeholder:"name",required:!0,minLength:"2",maxLength:"40",value:s||"",onChange:function(e){return l(e.target.value)}}),Object(j.jsx)("span",{id:"name-input-error"}),Object(j.jsx)("input",{type:"text",name:"job",id:"job-input",className:"form__input form__input_type_job",placeholder:"job",required:!0,minLength:"2",maxLength:"200",value:b||"",onChange:function(e){return m(e.target.value)}}),Object(j.jsx)("span",{id:"job-input-error"})]})};var w=function(e){var t=e.isOpen,n=e.onClose,a=e.onUpdateAvatar,c=o.a.useRef("");return o.a.useEffect((function(){c.current.value=""}),[t]),Object(j.jsx)("div",{children:Object(j.jsxs)(S,{name:"update-image-profile",title:"Change profile picture",formName:"profile-img",buttonSubmitTitle:"Save",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({avatar:c.current.value})},children:[Object(j.jsx)("input",{type:"url",name:"avatar",id:"avatar-input",className:"form__input form__input_type_avatar",placeholder:"avatar",required:!0,ref:c}),Object(j.jsx)("span",{id:"avatar-input-error"})]})})};var T=function(e){var t=e.isOpen,n=e.onClose,a=e.onAddPlaceSubmit,c=o.a.useState(""),i=Object(u.a)(c,2),r=i[0],s=i[1],l=o.a.useState(""),d=Object(u.a)(l,2),p=d[0],b=d[1];return o.a.useEffect((function(){s(""),b("")}),[t]),Object(j.jsxs)(S,{name:"add-card",title:"New Place",formName:"new",buttonSubmitTitle:"Create",isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),a({name:r,link:p})},children:[Object(j.jsx)("input",{type:"text",name:"card-title",id:"card-title-input",className:"form__input form__input_type_card-title",placeholder:"Title",required:!0,minLength:"1",maxLength:"30",value:r||"",onChange:function(e){return s(e.target.value)}}),Object(j.jsx)("span",{id:"card-title-input-error"}),Object(j.jsx)("input",{type:"url",name:"card-link",id:"card-link-input",className:"form__input form__input_type_card-link",placeholder:"Image link",required:!0,value:p||"",onChange:function(e){return b(e.target.value)}}),Object(j.jsx)("span",{id:"card-link-input-error"})]})};var L=function(e){return Object(j.jsx)("div",{className:e.isOpen?"popup popup_type_".concat(e.name," popup_open"):"popup popup_type_".concat(e.name),children:Object(j.jsxs)("div",{className:"popup__container popup__figure-container",children:[Object(j.jsx)("button",{type:"button","aria-label":"Close image",className:"popup__close-button",onClick:e.onClose}),Object(j.jsxs)("figure",{className:"popup__figure",children:[Object(j.jsx)("img",{alt:"default",src:e.selectedCard.link,className:"popup__image"}),Object(j.jsx)("figcaption",{className:"popup__caption","aria-label":e.selectedCard.name,children:e.selectedCard.name})]})]})})};var U=function(){return Object(j.jsx)("footer",{className:"footer",children:Object(j.jsx)("p",{className:"footer__text",children:"2021 Around The U.S."})})},E=n(23),A=n(24),P=function(e){return e.ok?e.json():Promise.reject("".concat(e.statusText))},q=function(e,t){return fetch(e,t).then(P)},I=new(Object(E.a)((function e(t){var n=this,a=t.baseUrl,o=t.headers;Object(A.a)(this,e),this.getUserInfo=function(e){return q("".concat(n._baseUrl,"/users/me"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})},this.getInitialCards=function(e){return q("".concat(n._baseUrl,"/cards"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})},this.addCard=function(e,t){var a=e.name,o=e.link;return q("".concat(n._baseUrl,"/cards"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"POST",body:JSON.stringify({name:a,link:o})})},this.deleteCard=function(e,t){return console.log("api",e),q("".concat(n._baseUrl,"/cards/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"DELETE"})},this.likeCard=function(e,t){return q("".concat(n._baseUrl,"/cards/likes/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PUT"})},this.dislikeCard=function(e,t){return q("".concat(n._baseUrl,"/cards/likes/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"DELETE"})},this.changeLikeCardStatus=function(e,t,a){return q("".concat(n._baseUrl,"/cards/likes/").concat(e),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},method:"".concat(t?"PUT":"DELETE")})},this.editProfileUserInfo=function(e,t){var a=e.name,o=e.about;return q("".concat(n._baseUrl,"/users/me"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PATCH",body:JSON.stringify({name:a,about:o})})},this.updateUserImage=function(e,t){return q("".concat(n._baseUrl,"/users/me/avatar"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"PATCH",body:JSON.stringify(e)})},this._baseUrl=a,this._headers=o})))({baseUrl:"http://localhost:3000"}),B="http://localhost:3000",D=(document.querySelector(".form__input_type_name"),document.querySelector(".form__input_type_job"),document.querySelector(".profile__edit-button"),document.querySelector(".profile__add-button"),document.querySelector(".profile__update-image"),document.querySelector(".popup_type_edit-profile"),document.querySelector(".popup_type_add-card"),document.querySelector(".popup_type_update-image-profile"),"Oops, something went wrong! Please try again.");var z=function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(""),r=Object(u.a)(i,2),p=r[0],b=r[1],_=Object(a.useState)(!1),O=Object(u.a)(_,2),x=O[0],N=O[1],E=Object(a.useState)(!1),A=Object(u.a)(E,2),q=A[0],z=A[1],J=Object(a.useState)(!1),F=Object(u.a)(J,2),R=F[0],H=F[1],Y=Object(a.useState)(!1),G=Object(u.a)(Y,2),M=G[0],K=G[1],Q=Object(a.useState)(!1),V=Object(u.a)(Q,2),W=V[0],X=V[1],Z=Object(a.useState)(!1),$=Object(u.a)(Z,2),ee=$[0],te=$[1],ne=Object(a.useState)({name:"",link:""}),ae=Object(u.a)(ne,2),oe=ae[0],ce=ae[1],ie=Object(a.useState)([]),re=Object(u.a)(ie,2),se=re[0],le=re[1],ue=Object(a.useState)({}),de=Object(u.a)(ue,2),pe=de[0],je=de[1],be=Object(a.useState)(""),me=Object(u.a)(be,2),he=me[0],fe=me[1],_e=Object(a.useState)(localStorage.getItem("jwt")),Oe=Object(u.a)(_e,2),ge=Oe[0],xe=Oe[1],ve=Object(d.g)(),Ce=function(){console.log("jwt",ge),ge?function(e){return console.log("token",e),fetch("".concat(B,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(P).then((function(e){return e}))}(ge).then((function(e){console.log("Res",e),e&&(console.log("emails",e.data.email),fe(e.data.email),N(!0),ve.push("/"))})).catch((function(e){"Bad Request"===e?console.error("400 \u2014 Token not provided or provided in the wrong format"):"Unauthorized"===e?console.error("401 \u2014 The provided token is invalid "):console.error(e)})):N(!1)},Ne=function(){z(!1),X(!1),H(!1),K(!1),te(!1)};return Object(a.useEffect)((function(){console.log("line 225"),Ce()}),[ge,ve]),Object(a.useEffect)((function(){console.log("line 231 ".concat(ge)),Promise.all([I.getUserInfo(ge),I.getInitialCards(ge)]).then((function(e){var t=Object(u.a)(e,2),n=t[0],a=t[1];je(Object(l.a)({},n)),le(Object(s.a)(a))})).catch(console.error)}),[ge]),o.a.useEffect((function(){var e=function(e){"Escape"===e.key&&Ne()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]),Object(j.jsx)("div",{className:"page__container",children:Object(j.jsxs)(C.Provider,{value:pe,children:[Object(j.jsxs)(d.d,{children:[Object(j.jsxs)(d.b,{path:"/signup",children:[Object(j.jsx)(m,{text:"Login",link:"/sigin"}),Object(j.jsx)(f,{onSignUp:function(e){(function(e){var t=e.email,n=e.password;return console.log("this email",t),console.log("this password",n),fetch("".concat(B,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then(P)})({email:e.email,password:e.password}).then((function(e){console.log(e),c(!0),b("Success! You have now been registered."),ve.push("/signin")})).catch((function(e){"Error: Bad Request"===e?console.error("400 - one of the fields was filled in incorrectly"):console.error("err",e),c(!1),b(D)})).finally((function(){return z(!0)}))}})]}),Object(j.jsxs)(d.b,{path:"/signin",children:[Object(j.jsx)(m,{text:"Sign Up",link:"/signup"}),Object(j.jsx)(h,{onLogin:function(e){var t=e.email,n=e.password;(function(e){var t=e.email,n=e.password;return console.log(" login and password ".concat(n," this email: ").concat(t)),fetch("".concat(B,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({email:t,password:n})}).then(P).then((function(e){return e.token?(localStorage.setItem("jwt",e.token),e):void 0}))})({email:t,password:n}).then((function(e){e.token?(xe(e.token),N(!0),c(!0),ve.push("/"),console.log("login app email",t)):(c(!1),b(D)),console.log("login before token")})).catch((function(e,t){console.log(e),"Bad Request"===e?console.error("400 - one or more of the fields were not provided"):"Unauthorized"===e?console.error("401 - the user with the specified email not found "):console.error("err",e),c(!1),b(D),z(!0)}))}})]}),Object(j.jsxs)(v,{isLoggedIn:x,exact:!0,path:"/",children:[Object(j.jsx)(m,{text:"Log out",link:"/",email:he,isLoggedIn:x,onSignOut:function(){localStorage.removeItem("jwt"),N(!1),fe(""),ve.push("/signin")}}),Object(j.jsx)(k,{onEditAvatarClick:function(){return X(!0)},onEditProfileClick:function(){return H(!0)},onAddPlaceClick:function(){return K(!0)},cards:se,onCardClick:function(e){ce({name:e.name,link:e.link}),te(!0)},onCardLike:function(e){var t=e.likes.some((function(e){return e._id===pe._id}));I.changeLikeCardStatus(e._id,!t).then((function(t){le((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch(console.error)},onCardDelete:function(e){I.deleteCard(e._id).then((function(t){le((function(t){return t.filter((function(t){return t._id!==e._id}))}))})).catch(console.error)}})]}),Object(j.jsx)(d.b,{children:x?Object(j.jsx)(d.a,{to:"/"}):Object(j.jsx)(d.a,{to:"/signin"})})]}),x?Object(j.jsx)(U,{}):"",Object(j.jsx)(g,{isOpen:q,onClose:Ne,isSuccessful:n,message:p}),Object(j.jsx)(y,{isOpen:R,onClose:Ne,onUpdateUser:function(e){I.editProfileUserInfo(e).then((function(e){je(Object(l.a)({},e)),H(!1)})).catch(console.error)}}),Object(j.jsx)(w,{isOpen:W,onClose:Ne,onUpdateAvatar:function(e){I.updateUserImage(e).then((function(e){je(Object(l.a)({},e)),X(!1)})).catch(console.error)}}),Object(j.jsx)(T,{isOpen:M,onClose:Ne,onAddPlaceSubmit:function(e){I.addCard(e).then((function(e){console.log("add res",e),le([e].concat(Object(s.a)(se))),K(!1)})).catch(console.error)}}),Object(j.jsx)(S,{name:"delete-card",title:"Are you sure ?",formName:"delete",buttonSubmitTitle:"Yes",onClose:Ne}),Object(j.jsx)(L,{isOpen:ee,name:"image",selectedCard:oe,onClose:Ne})]})})},J=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,39)).then((function(t){var n=t.getCLS,a=t.getFID,o=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),o(e),c(e),i(e)}))};i.a.render(Object(j.jsx)(o.a.StrictMode,{children:Object(j.jsx)(r.a,{children:Object(j.jsx)(z,{})})}),document.getElementById("root")),J()}},[[38,1,2]]]);
//# sourceMappingURL=main.e8e7ec97.chunk.js.map